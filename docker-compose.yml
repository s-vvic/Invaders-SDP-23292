version: '3.8'

services:
  # 1. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Node.js API)
  backend:
    # 1. backend í´ë”ì˜ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ë¹Œë“œ
    build:
      context: ./backend 
      dockerfile: Dockerfile
    
    # 2. ì»¨í…Œì´ë„ˆ ì´ë¦„ ì§€ì •
    container_name: my-backend-service
    
    # ğŸš¨ ì¤‘ìš”: ports ì„¹ì…˜ì„ ì œê±°í•˜ì—¬ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ë¡œ ë…¸ì¶œë˜ëŠ” í¬íŠ¸ë¥¼ ë§‰ìŠµë‹ˆë‹¤.
    # ë°±ì—”ë“œëŠ” ì´ì œ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€(í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ)ì—ì„œë§Œ 'backend:8080'ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    # ports:
    #   - "8080:8080"
    
    # 3. í™˜ê²½ ë³€ìˆ˜ ì£¼ì…
    env_file: ./backend/.env 
      
    # 4. ë¡œì»¬ ì½”ë“œ ì‹¤ì‹œê°„ ë°˜ì˜ (ê°œë°œ í¸ì˜ì„±)
    volumes:
      # â¬‡ï¸ ë¡œì»¬ ì†ŒìŠ¤ ì½”ë“œëŠ” ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. (ì´ê²ƒë§Œ ìœ ì§€)
      - ./backend:/usr/src/app 
      
    # 5. DB ì„œë¹„ìŠ¤ê°€ ì™„ì „íˆ ì¤€ë¹„ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
    depends_on:
      - db
      
  # 2. í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ (Nginxë¥¼ ì‚¬ìš©í•˜ì—¬ 8080 í¬íŠ¸ë¥¼ ì ìœ í•˜ê³  ì •ì  íŒŒì¼ ë° API ë¼ìš°íŒ… ì²˜ë¦¬)
  frontend:
    # 1. frontend í´ë”ì˜ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ë¹Œë“œ (Nginx ê¸°ë°˜)
    build:
      context: ./frontend 
      dockerfile: Dockerfile
    container_name: my-frontend-service
    
    # ğŸš¨ ìˆ˜ì •: ë¡œì»¬ 8080 í¬íŠ¸ë¥¼ í”„ë¡ íŠ¸ì—”ë“œ Nginx(80)ì— ì—°ê²°í•©ë‹ˆë‹¤.
    ports:
      - "8080:80" 
    
    # 2. ë¡œì»¬ ì½”ë“œ ì‹¤ì‹œê°„ ë°˜ì˜
    volumes:
      # ë¡œì»¬ frontend í´ë”ë¥¼ Nginxì˜ ì •ì  íŒŒì¼ ê²½ë¡œì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤.
      - ./frontend:/usr/share/nginx/html 
      # ì»¤ìŠ¤í…€ Nginx ì„¤ì • íŒŒì¼ë„ ë§ˆìš´íŠ¸í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë˜ë„ë¡ í•©ë‹ˆë‹¤.
      - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf
    
    # ë°±ì—”ë“œê°€ ì‹¤í–‰ëœ í›„ í”„ë¡ íŠ¸ì—”ë“œê°€ ì‹¤í–‰ë˜ë„ë¡ ì˜ì¡´ì„± ì„¤ì •
    depends_on:
      - backend 
    
  # 3. ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤
  db:
    image: busybox
    volumes:
      - ./data:/data
    container_name: my-database