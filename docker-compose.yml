version: '3.8'

services:
  # 1. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Node.js API)
  backend:
    build:
      context: ./backend 
      dockerfile: Dockerfile
    
    container_name: my-backend-service
    
    # ğŸš¨ ì¤‘ìš”: ports ì„¹ì…˜ì„ ì œê±°í•˜ì—¬ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ë¡œ ë…¸ì¶œë˜ëŠ” í¬íŠ¸ë¥¼ ë§‰ìŠµë‹ˆë‹¤.
    # ë°±ì—”ë“œëŠ” ì´ì œ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ì—ì„œë§Œ 'backend:8080'ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    # ports:
    #   - "8080:8080"
    
    # í™˜ê²½ ë³€ìˆ˜ ì£¼ì…: ë¡œì»¬ì˜ .env íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    env_file: ./backend/.env 
      
    # ë¡œì»¬ ì½”ë“œ ì‹¤ì‹œê°„ ë°˜ì˜ (ê°œë°œ í¸ì˜ì„±)
    volumes:
      # â¬‡ï¸ ë¡œì»¬ ì†ŒìŠ¤ ì½”ë“œëŠ” ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. (ì´ê²ƒë§Œ ìœ ì§€)
      - ./backend:/usr/src/app 
      
    depends_on:
      - db
      
  # 2. í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ (Nginxë¥¼ ì‚¬ìš©í•˜ì—¬ 8080 í¬íŠ¸ë¥¼ ì ìœ í•˜ê³  ì •ì  íŒŒì¼ ë° API ë¼ìš°íŒ… ì²˜ë¦¬)
  frontend:
    build:
      context: ./frontend 
      dockerfile: Dockerfile
    container_name: my-frontend-service
    
    # ë¡œì»¬ 8080 í¬íŠ¸ë¥¼ í”„ë¡ íŠ¸ì—”ë“œ Nginx(80)ì— ì—°ê²°í•©ë‹ˆë‹¤. (ìµœì¢… ì‚¬ìš©ì ì ‘ì† í¬íŠ¸)
    ports:
      - "8080:80" 
    
    # ë¡œì»¬ ì½”ë“œ ì‹¤ì‹œê°„ ë°˜ì˜ ë° Nginx ì„¤ì • íŒŒì¼ ë§ˆìš´íŠ¸
    volumes:
      - ./frontend:/usr/share/nginx/html 
      # Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì • íŒŒì¼ (frontend/nginx.conf)ì„ ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤.
      - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf
    
    # ë°±ì—”ë“œê°€ ì‹¤í–‰ëœ í›„ í”„ë¡ íŠ¸ì—”ë“œê°€ ì‹¤í–‰ë˜ë„ë¡ ì˜ì¡´ì„± ì„¤ì •
    depends_on:
      - backend 
    
  # 3. ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤
  db:
    image: busybox
    volumes:
      - ./data:/data
    container_name: my-database