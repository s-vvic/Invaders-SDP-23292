version: '3.8'

services:
  # 1. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Node.js API)
  backend:
    build:
      context: ./backend 
      dockerfile: Dockerfile
    
    container_name: my-backend-service
    
    # ğŸš¨ ìˆ˜ì •: CI í™˜ê²½ì—ì„œëŠ” .env íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, 
    # env_file ì„¤ì •ì„ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤. (ì¤„ ì „ì²´ ì œê±°)
    # env_file: ./backend/.env 
      
    volumes:
      # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì½”ë“œê°€ ë³´ì´ë„ë¡ ìœ ì§€í•©ë‹ˆë‹¤.
      - ./backend:/usr/src/app 
      
    depends_on:
      - db

  # 2. í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ (CIëŠ” í…ŒìŠ¤íŠ¸ë§Œ í•˜ë¯€ë¡œ ì‹¤í–‰ë  í•„ìš”ê°€ ì—†ìŒ)
  frontend: 
    build:
      context: ./frontend 
      dockerfile: Dockerfile
    container_name: my-frontend-service
    
    # ports ì œê±° ë° volumes ì œê±° (CIì—ì„œ ë¶ˆí•„ìš”)
    
    depends_on:
      - backend 

  # 3. ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤
  db:
    image: busybox
    volumes:
      - ./data:/data
    container_name: my-database